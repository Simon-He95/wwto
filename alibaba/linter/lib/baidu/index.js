import wx from './../../../adaptor.js';
const utils=require("../utils/utils"),unsupportedFns=require("./unsupported-fns"),unsupportedTags=require("./unsupported-tags"),unsupportedAttrs=require("./unsupported-attrs"),unsupportedEvents=require("./unsupported-events"),wxmlLineRules=[e=>{const r="组件百度小程序未实现";for(let s=0;s<unsupportedTags.length;s++){const u=unsupportedTags[s],t=new RegExp(`<${u}\\s+`);if(e.match(t))return{source:e,rule:[u,r].join("")}}return null},e=>{const r=/[^<>(?:]+/,s=e.match(/bind\w+\s*=\s*['"]([^'"]+)['"]/);return s&&!r.test(s[1])?{source:s[0],rule:"bind*={{str}}  `str`只能是函数名（字符串），不能包含函数计算（如：`bindtap=\"flag ? 'fn1' : 'fn2'\"`）"}:null},e=>{const r=/[^<>(?:]+/,s=e.match(/wx:for=['"](.+)['"]/);return s&&!r.test(s[1])?{source:e,rule:"wx:for={{arr}}  `arr`不能包含达式计算（如：`wx:for='{{flag ? arr1 : arr2}}'`）"}:null},e=>{return e.match(/\s+hidden=["'].+['"]/)?{source:e,rule:"wxml不支持`hidden`"}:null},e=>{const r=[{rule:"wxml不支持`hidden`",reg:"\\s+hidden=[\"'].+['\"]"},{rule:"scroll-view组件upper-threshold、lower-threshold、scroll-top、scroll-left属性不支持rpx",reg:"<scroll-view[^>]*(upper-threshold|lower-threshold|scroll-top|scroll-left)=[\"']\\d*rpx[\"']"},{rule:"swiper组件previous-margin、next-margin属性不支持rpx",reg:"<swiper[^>]*(previous-margin|next-margin)=[\"']\\d*rpx[\"']"},{rule:"icon组件size属性不支持rpx",reg:"<icon[^>]*size=[\"']\\d*rpx[\"']"},{rule:"progress组件stroke-width属性不支持rpx",reg:"<progress[^>]*stroke-width=[\"']\\d*rpx[\"']"},{rule:"input组件cursor-spacing属性不支持rpx",reg:"<input[^>]*cursor-spacing=[\"']\\d*rpx[\"']"},{rule:"textarea组件cursor-spacing属性不支持rpx",reg:"<textarea[^>]*cursor-spacing=[\"']\\d*rpx[\"']"},{rule:"input组件type属性不支持idcard",reg:"<input[^>]*type=[\"']idcard[\"']"},{rule:"live-player组件src属性仅支持m3u8",reg:"<live-player[^>]*src=[\"']((?!m3u8).)*[\"']"}];for(let s=0;s<r.length;s++){const u=new RegExp(r[s].reg);if(e.match(u))return{source:e,rule:r[s].rule}}return null}],wxmlFileRules=[(e,r)=>{const s=[];return e.replace(/<[^>]+wx:for=[^>]+wx:if=['"](.+)['"][^>]*>/g,u=>{const t=utils.calcLine(e,u);s.push({path:r,line:t,source:u,rule:"在同一个标签上，`wx:for`和`wx:if`不能同时使用"})}),s},(e,r)=>utils.unsupportedAttrOrEvents(e,r,unsupportedAttrs,"百度","属性"),(e,r)=>utils.unsupportedAttrOrEvents(e,r,unsupportedEvents,"百度","事件")],wxssLineRules=[],wxssFileRules=[],scriptFileRules=[],scriptLineRules=[e=>{const r="方法百度小程序未实现";for(let s=0;s<unsupportedFns.length;s++){const u=unsupportedFns[s],t=new RegExp(`\\.${u}\\(`);if(e.match(t))return{source:e,rule:[u,r].join("")}}return null}];module.exports={wxmlFileRules:wxmlFileRules,wxmlLineRules:wxmlLineRules,wxssFileRules:wxssFileRules,wxssLineRules:wxssLineRules,scriptFileRules:scriptFileRules,scriptLineRules:scriptLineRules};
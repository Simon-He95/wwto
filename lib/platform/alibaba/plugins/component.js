const APIMAP={request:"httpRequest",setNavigationBarTitle:"setNavigationBar",setNavigationBarColor:"setNavigationBar"},helpers=require("./helpers");module.exports=function({types:e}){return{name:"微信Js转支付宝Js",pre(){this.cache=new Map},visitor:{MemberExpression(t,r){let i=t.get("object.name").node,a=r.opts.relative;switch(i){case"wx":!function(t){let r=t.get("property.name").node,i=APIMAP[r];i&&t.get("property").replaceWith(e.Identifier(i))}(t);break;case"Reflect":this.cache.set("reflect",a)}},CallExpression(t){let r=t.get("callee");r.isIdentifier()&&"require"===r.get("name").node&&function(t){let r=t.get("arguments")[0];if(!r)throw t.buildCodeFrameError("require缺少参数");let i=(r.get("value").node||"").replace(/\.js$/,"");/^[\w$]/.test(i)&&(i=`./${i}`),r.replaceWith(e.StringLiteral(i))}(t)},StringLiteral(t){"wxMin"===t.get("value").node&&t.replaceWith(e.StringLiteral("alipay"))},Identifier(t){"wx"===t.get("name").node&&!t.scope.hasBinding("wx")&&t.isReferencedIdentifier()&&t.replaceWith(e.Identifier("my"))}},post(e){let t=this.cache.get("reflect"),r=e.ast.program.body;t&&r.unshift(helpers.requireReflect(t))}}};
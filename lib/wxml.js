const fs=require("fs"),gulp=require("gulp"),readLine=require("readline"),through2=require("through2"),ab2str=require("arraybuffer-to-string"),logger=require("../../utils/logger");function lintLine(e){return lineRules.map(r=>r(e)).filter(e=>e)}function lintFile(e,r){const t=ab2str(e.contents),n=e.path;let i=[];return r.forEach(e=>{i=i.concat(e(t,n))}),i}function lint(e="./src",r,t){gulp.src(e+"/**/*.wxml").pipe(through2.obj(function(e,t,n){const i=fs.createReadStream(e.path),l=readLine.createInterface({input:i}),u=lintFile(e,r),o=e.path;let s=0;l.on("line",e=>{s++,lintLine(e).forEach(e=>{u.push({path:o,line:s,source:e.source,rule:e.rule})})}),l.on("close",()=>{0===u.length&&logger.success("检测通过："+e.path),u.sort((e,r)=>e.line>r.line?1:-1),u.forEach(e=>{logger.lintWarning(e.path,e.line,e.source,e.rule)})}),this.push(e),n()}))}
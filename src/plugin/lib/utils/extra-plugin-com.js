const sysPath = require("path"); const gulp = require("gulp"); const through2 = require("through2"); const ab2str = require("arraybuffer-to-string"); const str2ab = require("to-buffer"); module.exports = function(t, s){ const e = { main: {}, coms: {} }; gulp.src(`${t}/**/plugin.json`).pipe(through2.obj(function(t, s, r){ const n = t.history[0].replace(t.base, "").split(sysPath.sep); const o = n[n.length - 2]; const u = ab2str(t.contents); const i = JSON.parse(u); e.main[o] = i.main, e.coms[o] = i.publicComponents, t.contents = str2ab(u), this.push(t), r(); })).pipe(gulp.dest(t)).on("end", () => { s(e); }); };
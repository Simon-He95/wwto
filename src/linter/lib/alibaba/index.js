const utils=require("../utils/utils"),unsupportedFns=require("./unsupported-fns"),unsupportedTags=require("./unsupported-tags"),unsupportedAttrs=require("./unsupported-attrs"),unsupportedEvents=require("./unsupported-events"),wxmlLineRules=[e=>{const r="组件支付宝小程序未实现";for(let t=0;t<unsupportedTags.length;t++){const s=unsupportedTags[t],u=new RegExp(`<${s}\\s+`);if(e.match(u))return{source:e,rule:[s,r].join("")}}return null},e=>{const r=`支付宝小程序 button 组件 不支持 ${["contact","getUserInfo","getPhoneNumber","openSetting","feedback"].join("|")} 属性`;return e.match("<button[^>]*open-type=[\"'](contact|getUserInfo|getPhoneNumber|openSetting|feedback)[\"']")?{source:e,rule:r}:null},e=>{const r=[{rule:"scroll-view组件upper-threshold、lower-threshold、scroll-top、scroll-left属性不支持rpx",reg:"<scroll-view[^>]*(upper-threshold|lower-threshold|scroll-top|scroll-left)=[\"']\\d*rpx[\"']"},{rule:"icon组件size属性不支持rpx",reg:"<icon[^>]*size=[\"']\\d*rpx[\"']"},{rule:"progress组件stroke-width属性不支持rpx",reg:"<progress[^>]*stroke-width=[\"']\\d*rpx[\"']"},{rule:"button组件open-type仅支持share",reg:"<button[^>]*open-type=[\"']((?!share).)*[\"']"},{rule:"navigator组件open-type不支持支持reLaunch、exit",reg:"<navigator[^>]*open-type=[\"'](reLaunch|exit)[\"']"}];for(let t=0;t<r.length;t++){const s=new RegExp(r[t].reg);if(e.match(s))return{source:e,rule:r[t].rule}}return null}],wxmlFileRules=[(e,r)=>utils.unsupportedAttrOrEvents(e,r,unsupportedAttrs,"支付宝","属性"),(e,r)=>utils.unsupportedAttrOrEvents(e,r,unsupportedEvents,"支付宝","事件")],wxssFileRules=[],wxssLineRules=[],scriptLineRules=[e=>{const r="方法支付宝小程序未实现";for(let t=0;t<unsupportedFns.length;t++){const s=unsupportedFns[t],u=new RegExp(`\\.${s}\\(`);if(e.match(u))return{source:e,rule:[s,r].join("")}}return null}],scriptFileRules=[(e,r)=>{const t=/['"][\w\/.]+['"]/,s=e.match(/require\(([^)]+)\)/);if(s&&!t.test(s[1])){return{line:utils.calcLine(e,s[0]),path:r,source:s[0],rule:"`require`，参数只能是字符串直接量，不能是变量（如：`var path = '/a/b/c'; require(path);`）"}}return null},(e,r)=>{const t=/triggerEvent\(['"]/,s=e.match(/triggerEvent\(([^)]+)\)/);if(s&&!t.test(s[0])){return{line:utils.calcLine(e,s[0]),path:r,source:s[0],rule:"triggerEvent(name, data)`，`name`目前只支持字符串直接量，不支持变量"}}return null}];module.exports={wxmlLineRules:wxmlLineRules,wxmlFileRules:wxmlFileRules,wxssLineRules:wxssLineRules,wxssFileRules:wxssFileRules,scriptLineRules:scriptLineRules,scriptFileRules:scriptFileRules};